var isFirefox=navigator.userAgent.toLowerCase().indexOf("firefox")>-1,isTouch=!1,canSVG=document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#Image","1.1");window.addEventListener("touchstart",function a(){isTouch=!0,window.removeEventListener("touchstart",a)},!1);var DreamPlayer=function(a){return this.settings=DreamPlayer.settings(a),this.settings?(this.elements=this.insert(),this.setEvents(),this.setPlayPause(),this.setProgressBar(),this.setSpinner(),this.setControls(),this.elements.player.style.height=this.elements.player.offsetWidth/(16/9)+"px",window.addEventListener("resize",function(a){return function(){a.style.height=a.offsetWidth/(16/9)+"px"}}(this.elements.player),!1),void this.loadSources()):(console.error("Une erreur est survenu lors de la création du player."),!1)};DreamPlayer.prototype.setControls=function(){this.showControls(),this.setTimeoutHideControls(),this.addEvent("mousemove","player",function(a,b){setTimeout(function(a){return function(){a.showControls()}}(b),1)}),this.addEvent("click","video",function(a,b){isTouch&&(" "+b.elements.controls.className+" ").search(" show ")>=0&&setTimeout(function(a){return function(){a.hideControls()}}(b),2)})},DreamPlayer.prototype.setTimeoutHideControls=function(){this.timeoutHideControls&&clearTimeout(this.timeoutHideControls),this.timeoutHideControls=setTimeout(function(a){a&&a.hideControls&&a.hideControls()},2500,this)},DreamPlayer.prototype.showControls=function(){(" "+this.elements.controls.className+" ").search(" show ")<=0&&(this.elements.player.style.cursor="",this.elements.controls.className+=" show",this.elements.player.className+=" show-settings"),this.setTimeoutHideControls()},DreamPlayer.prototype.hideControls=function(){(" "+this.elements.controls.className+" ").search(" show ")>=0&&(setTimeout(function(a){return function(){(" "+a.controls.className+" ").search(" show ")<=0&&(a.player.style.cursor="none")}}(this.elements),1e3),this.elements.controls.className=(" "+this.elements.controls.className+" ").replace("show",""),this.elements.player.className=(" "+this.elements.player.className+" ").replace("show-settings",""))},DreamPlayer.prototype.toogleClass=function(a){(" "+this.elements.player.className+" ").search(" "+a+" ")>=0?this.removeClass(a):this.addClass(a)},DreamPlayer.prototype.addClass=function(a){(" "+this.elements.player.className+" ").search(" "+a+" ")<0&&(this.elements.player.className+=" "+a)},DreamPlayer.prototype.removeClass=function(a){for(;(" "+this.elements.player.className+" ").search(" "+a+" ")>=0;)this.elements.player.className=this.elements.player.className.replace(a,"")},DreamPlayer.addClass=function(a,b){(" "+a.className+" ").search(" "+b+" ")<0&&(a.className+=" "+b)},DreamPlayer.removeClass=function(a,b){for(;(" "+a.className+" ").search(" "+b+" ")>=0;)a.className=a.className.replace(b,"")},DreamPlayer.prototype.insert=function(){var a={},b=document.createElement("div");b.className="player",a.player=b;var c=document.createElement("video");c.volume=0,c.setAttribute("autoplay",""),c.setAttribute("autobuffer",""),c.setAttribute("x-webkit-airplay","allow"),c.setAttribute("preload","auto"),c.setAttribute("poster",this.settings.poster),a.video=c;var d=document.createElement("source");d.type="video/mp4",a.srcMp4=d;var e=document.createElement("source");e.type="video/webm",a.srcWebm=e,c.appendChild(d),c.appendChild(e),b.appendChild(c);var f=document.createElement("div");f.className="controls",a.controls=f;var g=document.createElement("div");if(g.className="play-pause",canSVG&&!isFirefox){g.className="play-pause play-pause--svg";var h=document.createElementNS("http://www.w3.org/2000/svg","svg");h.setAttribute("class","play-pause__svg"),h.setAttribute("viewBox","0 0 32 32"),h.setAttribute("fill","white"),h.setAttribute("stroke","white"),h.setAttribute("stroke-linejoin","round"),h.setAttribute("stroke-width","8"),h.setAttribute("xmlns","http://www.w3.org/2000/svg");var i=document.createElementNS("http://www.w3.org/2000/svg","polygon");i.setAttribute("points","6,4 28,16 6,16 6,16"),h.appendChild(i),a.playPauseSVG1=i;var j=document.createElementNS("http://www.w3.org/2000/svg","polygon");j.setAttribute("points","6,16 28,16 6,28 6,28"),h.appendChild(j),a.playPauseSVG2=j,g.appendChild(h),a.playPauseSVG=g}a.playPause=g,b.appendChild(g);var k=document.createElement("div");k.className="icons";var l=document.createElement("div");l.className="icon icon--settings",a.settings=l;var m=document.createElement("div");m.className="icon icon--settings",a.settings2=m;var n=document.createElement("div");n.className="icon icon--settings",a.settings3=n,k.appendChild(l),k.appendChild(m),k.appendChild(n),b.appendChild(k);var f=document.createElement("div");f.className="controls",a.controls=f;var o=document.createElement("div");o.className="controls__wrap",f.appendChild(o);var p=document.createElement("div");p.className="progress-bar";var q=document.createElement("div");q.className="progress-bar__wrap",p.appendChild(q);var r=document.createElement("div");r.className="progress-bar__viewed",r.style.width="0%";var s=document.createElement("div");s.className="progress-bar__current",s.style.left="0%";var t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("class","progress-bar__spinner"),t.setAttribute("viewBox","0 0 32 32"),t.setAttribute("xmlns","http://www.w3.org/2000/svg");var u=document.createElementNS("http://www.w3.org/2000/svg","circle");u.setAttribute("fill","none"),u.setAttribute("stroke","white"),u.setAttribute("stroke-width","3"),u.setAttribute("stroke-linecap","round"),u.setAttribute("cx","16"),u.setAttribute("cy","16"),u.setAttribute("r","14"),t.appendChild(u);var v=document.createElement("div");return v.className="progress-bar__buffer",v.style.width="0%",q.appendChild(r),q.appendChild(s),q.appendChild(t),q.appendChild(v),a.progressBar=p,a.progressBar.viewed=r,a.progressBar.current=s,a.progressBar.spinner=t,a.progressBar.buffer=v,o.appendChild(p),b.appendChild(f),this.settings.cible.appendChild(b),a},DreamPlayer.getOffsets=function(a){for(var b=0,c=0;a&&!isNaN(a.offsetLeft)&&!isNaN(a.offsetTop);)b+=a.offsetLeft-a.scrollLeft,c+=a.offsetTop-a.scrollTop,a=a.offsetParent;return{top:c,left:b}},DreamPlayer.prototype.addEvent=function(a,b,c){b="string"==typeof b?this.elements[b]:b;for(var d=0;d<this.events.length;d++)if(this.events[d].name.toLowerCase()==a.toLowerCase()){for(var e={events:[],callback:c,that:this,condition:this.events[d].condition},f=0;f<this.events[d].events.length;f++)e.events.push(this.events[d].events[f]),b.addEventListener(this.events[d].events[f],this.onEvent,!1);b.eventsListeners||(b.eventsListeners=[]),b.eventsListeners.push(e)}},DreamPlayer.prototype.onEvent=function(a){if(this.eventsListeners.length&&"undefined"!=typeof a)for(var b=0;b<this.eventsListeners.length;b++)for(var c=0;c<this.eventsListeners[b].events.length;c++)a.type==this.eventsListeners[b].events[c]&&(!this.eventsListeners[b].condition||this.eventsListeners[b].condition(a,this))&&this.eventsListeners[b].callback(a,this.eventsListeners[b].that)},DreamPlayer.prototype.setEvents=function(){this.events=[];for(var a=0;a<DreamPlayer.events.length;a++){for(var b={name:DreamPlayer.events[a].name,events:[],condition:DreamPlayer.events[a].condition?DreamPlayer.events[a].condition:null},c=0;c<DreamPlayer.events[a].events.length;c++)b.events.push(DreamPlayer.events[a].events[c]);this.events.push(b)}if(this.settings.debug){eventsNames="";for(var a=0;a<this.events.length;a++)eventsNames+=(a>0&&a<this.events.length-1?", ":"")+(a==this.events.length-1?" et ":"")+this.events[a].name;console.info("events setted",'"'+eventsNames+'"',this.events,"- DreamPlayer.prototype.setEvents")}},DreamPlayer.events=[{name:"click",events:["click"]},{name:"dblClick",events:["dblclick"]},{name:"mouseDown",events:["mousedown"]},{name:"mouseUp",events:["mouseup"]},{name:"mouseMove",events:["mousemove"]},{name:"mouseOut",events:["mouseout"]},{name:"keyDown",events:["keydown"]},{name:"canPlay",events:["canplay"]},{name:"play",events:["play"]},{name:"pause",events:["pause"]},{name:"timeUpdate",events:["timeupdate"]},{name:"loadedMetaData",events:["loadedmetadata"]},{name:"mouseWheelUp",events:["mousewheel","DOMMouseScroll"],condition:function(a){return a.wheelDelta>0||a.detail<0}},{name:"mouseWheelDown",events:["mousewheel","DOMMouseScroll"],condition:function(a){return a.wheelDelta<0||a.detail>0}},{name:"orientationChange",events:["orientationchange"]}],DreamPlayer.prototype.setPlayPause=function(){this.addEvent("click","video",function(a,b){isTouch||b.tooglePlayPause()}),this.addEvent("mouseDown","playPause",function(a,b){b.tooglePlayPause()}),this.addEvent("play","video",function(a,b){if(b.addClass("playing"),b.elements.playPauseSVG){b.elements.playPauseSVG1.innerHTML="",b.elements.playPauseSVG2.innerHTML="";var c=document.createElementNS("http://www.w3.org/2000/svg","animate");c.setAttribute("attributeType","XML"),c.setAttribute("attributeName","points"),c.setAttribute("from",b.elements.playPauseSVG1.getAttribute("points")),c.setAttribute("to","26,4 26,28 24,28 24,4"),c.setAttribute("begin","indefinite"),c.setAttribute("dur",".18s"),b.elements.playPauseSVG1.setAttribute("points","6,4 8,4 8,28 6,28");var d=document.createElementNS("http://www.w3.org/2000/svg","animate");d.setAttribute("attributeType","XML"),d.setAttribute("attributeName","points"),d.setAttribute("from",b.elements.playPauseSVG2.getAttribute("points")),d.setAttribute("to","6,4 8,4 8,28 6,28"),d.setAttribute("begin","indefinite"),d.setAttribute("dur",".18s"),b.elements.playPauseSVG2.setAttribute("points","24,4 26,4 26,28 24,28"),b.elements.playPauseSVG1.appendChild(c),b.elements.playPauseSVG2.appendChild(d),c.beginElement(),d.beginElement()}}),this.addEvent("pause","video",function(a,b){if(b.removeClass("playing"),b.elements.playPauseSVG){b.elements.playPauseSVG1.innerHTML="",b.elements.playPauseSVG2.innerHTML="";var c=document.createElementNS("http://www.w3.org/2000/svg","animate");c.setAttribute("attributeType","XML"),c.setAttribute("attributeName","points"),c.setAttribute("from",b.elements.playPauseSVG1.getAttribute("points")),c.setAttribute("to","6,4 28,16 6,16 6,16"),c.setAttribute("begin","indefinite"),c.setAttribute("dur",".18s"),b.elements.playPauseSVG1.setAttribute("points","6,4 28,16 6,16 6,16");var d=document.createElementNS("http://www.w3.org/2000/svg","animate");d.setAttribute("attributeType","XML"),d.setAttribute("attributeName","points"),d.setAttribute("from",b.elements.playPauseSVG2.getAttribute("points")),d.setAttribute("to","6,16 28,16 6,28 6,28"),d.setAttribute("begin","indefinite"),d.setAttribute("dur",".18s"),b.elements.playPauseSVG2.setAttribute("points","6,16 28,16 6,28 6,28"),b.elements.playPauseSVG1.appendChild(c),b.elements.playPauseSVG2.appendChild(d),c.beginElement(),d.beginElement()}})},DreamPlayer.prototype.play=function(){this.elements.video.play()},DreamPlayer.prototype.pause=function(){this.elements.video.pause()},DreamPlayer.prototype.tooglePlayPause=function(){this.elements.video.paused?this.play():this.pause()},DreamPlayer.prototype.bufferUpdate=function(){var a=this.elements.video;a.buffered&&a.buffered.length>0&&(this.elements.progressBar.buffer.style.width=a.buffered.end(a.buffered.length-1)/a.duration*100+"%")},DreamPlayer.prototype.timeTo=function(a){var b=this.elements.video;b.currentTime=a},DreamPlayer.prototype.changeTime=function(a){var b=this.elements.progressBar,c=b.offsetWidth,d=Math.max(Math.min(a.pageX-DreamPlayer.getOffsets(b).left,c),0),e=d/c*100,f=e/100*this.elements.video.duration;isNaN(f)||(this.elements.progressBar.viewed.style.width=e+"%",this.elements.progressBar.current.style.left=e+"%",this.elements.progressBar.spinner.style.left=e+"%",this.timeTo(f))},DreamPlayer.prototype.setProgressBar=function(){this.addEvent("timeupdate","video",function(a,b){var c=b.elements.video.currentTime/b.elements.video.duration*100;b.elements.progressBar.viewed.style.width=c+"%",b.elements.progressBar.current.style.left=c+"%",b.elements.progressBar.spinner.style.left=c+"%",b.bufferUpdate()}),this.addEvent("loadedmetadata","video",function(a,b){b.bufferUpdate()}),this.addEvent("mousedown","progressBar",function(a,b){(" "+b.elements.controls.className+" ").search(" show ")>=0&&(b.progressBarClicking=!0,DreamPlayer.addClass(b.elements.progressBar,"progress-bar--clicking"),b.changeTime.call(b,a))}),this.addEvent("mouseup","progressBar",function(a,b){(" "+b.elements.controls.className+" ").search(" show ")>=0&&(b.progressBarClicking=!1,DreamPlayer.removeClass(b.elements.progressBar,"progress-bar--clicking"),b.changeTime.call(b,a))}),this.addEvent("mousemove","player",function(a,b){b.progressBarClicking&&b.changeTime.call(b,a)}),this.addEvent("touchmove","player",function(a,b){b.progressBarClicking&&b.changeTime.call(b,a)})},DreamPlayer.prototype.setSpinner=function(){return isFirefox?(this.elements.progressBar.spinner.parentNode.removeChild(this.elements.progressBar.spinner),!1):(this.elements.progressBar.spinner.style.opacity=1,this.elements.video.addEventListener("waiting",function(a){return function(){a.elements.progressBar.spinner.style.opacity=1}}(this),!1),this.elements.video.addEventListener("seeking",function(a){return function(){a.elements.progressBar.spinner.style.opacity=1}}(this),!1),this.addEvent("play","video",function(a,b){b.elements.progressBar.spinner.style.opacity=0}),void this.elements.video.addEventListener("seeked",function(a){return function(){a.elements.progressBar.spinner.style.opacity=0}}(this),!1))},DreamPlayer.settings=function(a){if(!(a&&a.poster&&a.cible&&a.sources))return console.error("Erreur lors de la récupération des paramètres de la vidéo",a),!1;for(var b={debug:a.debug?a.debug:!1,poster:a.poster,cible:a.cible,sources:[]},c=0;c<a.sources.length;c++){var d=a.sources[c];if(!(d.format&&d.mp4&&d.webm))return console.error("Erreur lors de la récupération des formats de la vidéo",d),!1;b.sources.push({format:d.format,mp4:d.mp4,webm:d.webm})}return b},DreamPlayer.prototype.loadSources=function(){for(var a="none",b=0;b<this.settings.sources.length;b++)this.elements.player.offsetWidth-this.settings.sources[b].format>0&&(a=b);"none"==a&&(a=0),this.elements.srcMp4.src=this.settings.sources[a].mp4,this.elements.srcWebm.src=this.settings.sources[a].webm,this.settings.debug&&console.info("format",this.settings.sources[a].format)};